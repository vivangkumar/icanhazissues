function updateIssue(e,t,o,i,s){{var a="/issues/"+ownerName+"/"+repositoryName+"/update/"+e,n={issueTitle:s,oldLabel:t,newLabel:o,blocked:i};$.ajax({url:a,type:"POST",data:n,success:function(e){console.log(e)},error:function(e){console.log("Error: "+JSON.parse(e))}})}}function getColourCode(e){var e=new Date(e),t=new Date,o=t-e,i=864e5,s=t-t%i-i;return e>s?"#00B16A":7*i>o?"#F7CA18":14*i>o?"#F9690E":"#F22613"}function assignColourCode(){$(".issue-list-item").each(function(){var e=getColourCode($(this).attr("data-updated"));$(this).css("border-left-width","5px").css("border-left-color",e)})}function addBlockedLabel(){$('.issue-list-item[data-blocked="true"]').each(function(){var e='<span class="label label-danger">BLOCKED</span>';$(this).find(".issue-text").append("  "+e)})}function addMenu(){$(".heading-column:first-child").append('<a class="menu-button pull-left" data-toggle="dropdown" id="menu-dropdown"><i class="fa fa-bars fa-sm"></i></a><ul class="dropdown-menu" role="menu" aria-labelledby="menu-dropdown"><li role="presentation" class="dropdown-header">'+repositoryName+'</li><li role="presentation"><a role="menuitem" tabindex="-1" href="/repos">Repository search</a></li><li role="presentation"><a class="toggle-done" role="menuitem" tabindex="-1" href="#">Toggle done items</a></li><li role="presentation"><a role="menuitem" tabindex="-1" href="/logout">Logout</a></li></ul>')}function addNewIssueButton(){var e="https://github.com/"+ownerName+"/"+repositoryName+"/issues/new";$(".heading-column:last-child").append('<a class="add-issue-button pull-right" target="_blank" href="'+e+'"><i class="fa fa-plus fa-sm"></i></a>')}function toggleDoneColumn(){$(".toggle-done").click(function(){localStorage.doneColumn="false"==localStorage.doneColumn?"true":"false",$(".issue-list-item-done").toggle(),$(".done-bucket").toggle(),"rgb(3, 166, 120)"==$(this).css("color")?$(this).css("color","white"):$(this).css("color","#03A678")})}function retainPreviousSetting(){"false"==localStorage.doneColumn&&($(".done-bucket").css("display","block"),$(".issue-list-item-done").hide(),$(".toggle-done").css("color","#03A678"))}function setupNotification(){Notification||console.log("This browser does not support notifications"),"granted"!==Notification.permission&&Notification.requestPermission()}function triggerNotification(e,t,o){var i=new Notification(e+" is ready to be reviewed!",{tag:"icanhazissues-review-notification",body:"Card has been moved to the review column for the "+o+" milestone."});i.onclick=function(){window.open(t)},i.onshow=function(){setTimeout(i.close.bind(i),1e4)}}var pusher=new Pusher(pusherKey,{authEndpoint:"/pusher/auth"}),repositoryName=window.location.pathname.split("/")[3],ownerName=window.location.pathname.split("/")[2],channel=pusher.subscribe("private-issues-"+repositoryName+"-"+ownerName);channel.bind("client-issue-updates",function(e){var t="#"+e.fromLabel+"-"+e.issueNumber,o=e.fromLabel,i=e.toLabel,s=e.toMilestone,a=e.fromMilestone,n=e.fromCount,l=e.toCount,r=e.issueLink,u=e.issueTitle;$(t).remove();var d="."+s+"-"+i+"-list-group";if("done"==i&&($("."+s+"-done-badge").html(l),$("."+s+"-"+i+"-list-group").attr("data-count",l)),"done"==o&&($("."+a+"-"+o+"-list-group").attr("data-count",n),$("."+a+"-done-badge").html(n)),$(d).append(e.cardHtml),"done"==i){var m=$(".issue-list-item[data-issue-number="+e.issueNumber+"]");"false"==localStorage.doneColumn?m.css("display","none"):m.css("display","block")}"review"==i&&triggerNotification(u,r,s)});for(var issueGroups=document.getElementsByClassName("issue-list-group"),fromLabel="",toLabel="",fromMilestone="",toMilestone="",i=0;i<issueGroups.length;i++){var issueMilestone=issueGroups[i].getAttribute("data-milestone");Sortable.create(issueGroups[i],{group:"issue-"+issueMilestone,animation:150,dragable:".issue-list-item",ghostClass:"sortable-ghost",filter:".done-bucket",onStart:function(e){var t=e.item.parentNode;fromLabel=t.getAttribute("data-label"),fromMilestone=t.getAttribute("data-milestone").replace(/ /g,"-")},onEnd:function(e){var t=e.item.getAttribute("data-issue-number"),o=e.item.getElementsByTagName("a")[0].innerHTML,i=e.item.getElementsByTagName("a")[0].href,s=e.item.parentNode,a=!1;toLabel=s.getAttribute("data-label"),toMilestone=s.getAttribute("data-milestone").replace(/ /g,"-"),"true"==e.item.getAttribute("data-blocked")&&(a=!0);var n={issueNumber:t,issueTitle:o,fromMilestone:fromMilestone,toMilestone:toMilestone,fromLabel:fromLabel,toLabel:toLabel,issueLink:i};if(fromLabel!=toLabel&&fromMilestone==toMilestone){var l=parseInt(s.getAttribute("data-count"));s.setAttribute("data-count",l+1);var r=parseInt(document.getElementsByClassName(fromMilestone+"-"+fromLabel+"-list-group")[0].getAttribute("data-count"));document.getElementsByClassName(fromMilestone+"-"+fromLabel+"-list-group")[0].setAttribute("data-count",r-1),"done"==toLabel&&("false"==localStorage.doneColumn&&(e.item.style.display="none"),$("."+toMilestone+"-done-badge").html(l+1),e.item.classList.add("issue-list-item-done"),e.item.classList.remove("issue-list-item-"+fromLabel)),"done"==fromLabel&&(e.item.classList.remove("issue-list-item-done"),e.item.classList.add("issue-list-item-"+toLabel),$("."+fromMilestone+"-done-badge").html(r-1)),e.item.setAttribute("id",toLabel+"-"+t),n.cardHtml=e.item.outerHTML,n.fromCount=r-1,n.toCount=l+1,channel.trigger("client-issue-updates",n),updateIssue(t,fromLabel,toLabel,a,o)}}})}$(window).load(function(){addMenu(),addNewIssueButton(),assignColourCode(),addBlockedLabel(),toggleDoneColumn(),retainPreviousSetting(),setupNotification()});